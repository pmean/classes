---
title: "5502 module 01 demonstration program"
format: 
  html:
    embed-resources: true
editor: source
---

## File details

This program was written by Steve Simon on 2025-01-20 and is placed in the public domain. You can use this program any way you please.

This program reads data on a study of breast feeding in preterm infants. Refer to the [data dictionary][ref01] for a more detailed description.

[ref01]: https://github.com/pmean/data/blob/main/files/breast-feeding-preterm.yaml

```{r}
#| label: setup
#| message: false
#| warning: false

library(glue)
library(tidyverse)
R.version.string
Sys.Date()
```

## Intermediate datasets

-   bf: Original file
-   bf_1: Replace -1 throughout with NA
-   bf_2: Create indicator for treatment
-   bf_3: Create indicator for control

## Read breast-feeding-preterm data

```{r}
#| label: read-bf
#| message: false
#| warning: false

bf <- read_csv(
  file="../data/breast-feeding-preterm.csv",
  col_names=TRUE)
glimpse(bf)
```

## Replace -1 with NA

```{r}
#| label: replace-missing

bf |>
  mutate(age_stop=na_if(age_stop, -1)) -> bf_1
```

#### Comments on the code

The [na_if][ref01] function (part of the dplyr/tidyverse library) replaces values in a vector with the code for missing in R (NA). In this code, any value of age_stop equal to -1 is converted to missing. There are several variables where this needs to be done, but in all of the analyses planned on this data, conversion to NA is only needed for age_stop.

[ref01]: https://dplyr.tidyverse.org/reference/na_if.html 

## Descriptive statistics for feed_type

```{r}
#| label: feed_type

bf_1 |>
  count(feed_type) |>
  mutate(total=sum(n)) |>
  mutate(pct=round(100*n/total)) |>
  mutate(pct=glue("{pct}% ({n}/{total})"))
```

#### Interpretation of the output

Slightly more than half of the infants are in the control group.

## Descriptive statistics for age_stop

```{r}
#| label: age_stop-1

bf_1 |>
  summarize(
    stop_mean=round(mean(age_stop, na.rm=TRUE), 1),
    stop_sd=round(sd(age_stop, na.rm=TRUE), 1),
    stop_min=min(age_stop, na.rm=TRUE),
    stop_max=max(age_stop, na.rm=TRUE),
    n_missing=sum(is.na(age_stop)))
```

#### Interpretation of the output

The average infant stopped breast feeding before 17 weeks. There is a lot of spread in the data with infants stopping after only one week to stopping after 34 weeks.

## Histogram for age_stop

```{r}
#| label: age_stop-2
bf_1 |>
  filter(!is.na(age_stop)) |>
  ggplot() +
    aes(x=age_stop) +
    geom_histogram(
      binwidth=5,
      color="black",
      fill="white")
```

#### Interpretation of the output

The distribution appears to be bimodal.

## Descriptive statistics for mom_age

```{r}
#| label: mom_age-1

bf_1 |>
  summarize(
    mom_age_mean=round(mean(mom_age, na.rm=TRUE), 1),
    mom_age_sd=round(sd(mom_age, na.rm=TRUE), 1),
    mom_age_min=min(mom_age, na.rm=TRUE),
    mom_age_max=max(mom_age, na.rm=TRUE),
    n_missing=sum(is.na(mom_age)))
```

#### Interpretation of the output

The average mother is 27 years old, with a moderate standard deviation of 7. The ages range from 16 to 44 years, which are reasonable values.

## Histogram for mom_age

```{r}
#| label: mom_age-2
bf_1 |>
  filter(!is.na(mom_age)) |>
  ggplot() +
    aes(x=mom_age) +
    geom_histogram(
      binwidth=5,
      color="black",
      fill="white")
```

#### Interpretation of the output

The distribution of mother's ages appears to be reasonably close to a normal distribution.

## Scatterplot of mom_age versus age_stop

Not ready yet

#### Interpretation of the output

Not ready yet

## Create regression model predicting age_stop from mom_age

```{r}
#| label: plot-bf-1
m1 <- lm(age_stop~mom_age, data=bf)
tidy(m1)
```



## Save everything

```{r}
#| label: save
save(
  bf, 
  m1, 
  file="../data/module01.RData")
```