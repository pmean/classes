---
title: "simon-5502-11-solution"
format: docx
editor: source
execute: 
  error: false
---

## File details

This program was written by Steve Simon on 2025-03-30 and is placed in the public domain. You can use this program any way you please.

-   Data used in this program
    -    [arthritis-treatments.txt][ref-oa]
    -    [data dictionary][ref-oa-dd]

[ref-oa]: https://github.com/pmean/data/blob/main/files/arthritis-treatments.txt
[ref-oa-dd]: https://github.com/pmean/data/blob/main/files/arthritis-treatments.yaml


-   Tibbles created by this program
    -   oa: Original data from arthritis-treatments.txt
    -   oa_1: Renamed variables, exclude ROM variables
    -   oa_2: Pivot to a wide format
-   Models created by this program
    -   m1: Random effects model

```{r}
#| message: false
#| warning: false
#| label: setup

library(broom)
library(foreign)
library(lme4)
library(tidyverse)

R.version.string
Sys.Date()
```

## Read oa

```{r}
#| label: read-oa

oa <- read_table(
  file="../data/arthritis-treatments.txt",
  col_names=TRUE,
  col_types="nnnnnnn")

glimpse(oa)
```

## Question 2 (done out of order!)

Select the pain variables (those ending in VAS) and pivot the data to a wider format. Include a glimpse of the original data and the pivoted data to show that the restructuring was done properly. The original dataset should have 10 rows and 4 columns (after removing the range of motion measurements). The restructured dataset should have 30 rows and 3 columns.

```{r}
#| label: subset

oa |>
  select(
    Subject,
    NoVAS,
    TENSVAS,
    SWDVAS) |>
  rename(
    no=NoVAS,
    tens=TENSVAS,
    swd=SWDVAS) -> oa_1
```

```{r}
#| label: long

oa_1 |>
  pivot_longer(
    cols=no:swd,
    names_to="treatment",
    values_to="vas") -> oa_2

glimpse(oa_2)
```

## Question 1

You will not be graded on this, but get in the habit of drawing a few graphs and computing a few statistics that will help you better understand the dataset you are working with. Only examine variables that will be part of the further analyses.

It would also be fine to wait until after restructuring to calculate descriptive statistics.

```{r}
#| label: descriptives-oa

oa_2 |>
  group_by(treatment) |>
  summarize(
    vas_mean=mean(vas),
    vas_sd=sd(vas)) -> oa_means

oa_means
```

## Question 3

Draw a line graph. Do the data show a consistent pattern (e.g., patients with large values on one measurement tend to have large values on the other measurements)?

```{r}
#| label: plot-1

oa_2 |>
  ggplot() +
  aes(
    x = treatment, 
    y = vas, 
    group = Subject) +
  geom_line() +
	labs(
		x="Treatment",
		y="Pain (visual analog scale)",
		title="Line graph of pain across treatments",
		caption="Simon, 2025-04-29") -> oa_plot

oa_plot
```

## Question 4

Fit a mixed model with pain score (vas) as the dependent variable, treatment as the independent variable, and Subject as a random effect. Interpret the fixed effects. Are the t-statistics for TENS and SWD close enough to zero to conclude that there is no effect of the two treatments on pain, compared to the control group?

```{r}
#| label: mixed-oa

m1 <- lmer(
  vas ~ treatment + (1 | Subject),
  data=oa_2)

summary(m1)
```

## Question 5

Calculate the intraclass correlation. It is very small. What does this tell you?

```{r}
#| label: icc

icc <- 4.133e-15 /(4.133e-15 + 4.652e+00)

icc
```
