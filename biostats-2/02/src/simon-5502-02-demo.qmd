---
title: "5502 module 02 demonstration program"
format: 
  html:
    embed-resources: true
editor: source
---

## File details

This program was written by Steve Simon on 2025-01-23 and is placed in the public domain. You can use this program any way you please.

This program reads [fat.csv][ref01],a dataset that compares body fat measurements to girth measurements at various body locations. Refer to the [data dictionary][ref02] for a more detailed description.

[ref01]: https://github.com/pmean/data/blob/main/files/fat.csv
[ref02]: https://github.com/pmean/data/blob/main/files/fat.yaml

```{r}
#| label: setup
#| message: false
#| warning: false

library(glue)
library(tidyverse)
library(broom)
R.version.string
Sys.Date()
```

## Intermediate files

-   fat: original data from fat.csv
-   m1: linear regression using chest, abdomen, hip to predict fat_b
-   m0: linear regression with just an intercept

## Read the data

```{r}
#| label: read

fat <- read_csv(
  file="../data/fat.csv",
  col_names=TRUE,
  col_types="n")
glimpse(fat)
```

#### Comments on the code

There are 19 columns of data, but they are all numeric, so a single "n" for col_types will do the trick.

## Descriptive statistics for fat_b

```{r}
#| label: descriptives-1

fat |>
  summarize(
    fat_mean=mean(fat_b),
    fat_sd=sd(fat_b),
    fat_min=min(fat_b),
    fat_max=max(fat_b))
```

#### Interpretation of the output

The average patient has 19% body fat. The data has a wide range from 0% (check this value!) to 45%

## Histogram for fat_b

```{r}
#| label: histogram-1

fat |>
  ggplot() +
  aes(x=fat_b) +
  geom_histogram(
    binwidth=5,
    color="black",
    fill="white") +
  xlab("Percentage body fat") +
  ggtitle("Graph drawn by Steve Simon on 2025-01-23")
```

#### Interpretation of the output

Percentage body fat has a roughly normal distribution.

## Descriptive statistics for chest

```{r}
#| label: descriptives-2

fat |>
  summarize(
    chest_mean=mean(chest),
    chest_sd=sd(chest),
    chest_min=min(chest),
    chest_max=max(chest))
```

#### Interpretation of the output

The average chest circumference is 101 centimeters. The range, 79 to 136 centimeters is fairly narrow.

## Histogram for chest

```{r}
#| label: histogram-2

fat |>
  ggplot() +
  aes(x=chest) +
  geom_histogram(
    binwidth=2,
    color="black",
    fill="white") +
  xlab("Chest circumference (cm)") +
  ggtitle("Graph drawn by Steve Simon on 2025-01-23")
```

#### Interpretation of the output

Although normality is not needed for the independent variables, here is a histogram, showing a slightly right skewed distribution for chest circumference.

## Descriptive statistics for abdomen

```{r}
#| label: descriptives-3

fat |>
  summarize(
    abdomen_mean=mean(abdomen),
    abdomen_sd=sd(abdomen),
    abdomen_min=min(abdomen),
    abdomen_max=max(abdomen))
```

#### Interpretation of the output

The average patient has a abdomen circumference of 92 centimeters, slightly smaller than the average chest circumference. The range from 70 to 148 centimeters is quite wide, certainly wider than the range for chest circumference.

## Histogram for abdomen

```{r}
#| label: histogram-3

fat |>
  ggplot() +
  aes(x=abdomen) +
  geom_histogram(
    binwidth=2,
    color="black",
    fill="white") +
  xlab("Abdomen circumference (cm)") +
  ggtitle("Graph drawn by Steve Simon on 2025-01-23")
```

#### Interpretation of the output

The distribution of abdomen circumferences is skewed right with one outlier on the high end.

## Descriptive statistics for hip

```{r}
#| label: descriptives-4

fat |>
  summarize(
    hip_mean=mean(hip),
    hip_sd=sd(hip),
    hip_min=min(hip),
    hip_max=max(hip))
```

#### Interpretation of the output

The average patient has a hip circumference of 100 centimeters. The range, from 85 to 148 centimeters is fairly narrow.

## Histogram for abdomen

```{r}
#| label: histogram-4

fat |>
  ggplot() +
  aes(x=hip) +
  geom_histogram(
    binwidth=2,
    color="black",
    fill="white") +
  xlab("Hip circumference (cm)") +
  ggtitle("Graph drawn by Steve Simon on 2025-01-23")
```

#### Interpretation of the output

The distribution of hip circumferences is skewed to the right with a pair of outliers around 126 and 148 centimeters.

## Correlations

```{r}
#| label: correlations

fat |>
  select(
    fat_b,
    chest,
    abdomen,
    hip) |>
  cor() |>
  round(2)
```

#### Interpretation of the output

Not too surprisingly, there are many strong positive correlations. Patients with higher body fat tend to have higher circumferences and a larger circumference measure at one location tends to be associated with larger circumference measures at other locations.

## Scatterplot of chest circumference and body fat

```{r}
#| label: plot-1

fat |>
  ggplot() +
  aes(x=chest, y=fat_b) +
  geom_point() +
  geom_smooth(method="lm", se=FALSE) +
  xlab("Chest circumference (cm)") +
  ylab("Percentage body fat") +
  ggtitle("Graph drawn by Steve Simon on 2025-01-25")
```

#### Interpretation of the output

There is a weak positive relationship between chest circumference and percentage body fat.

## Scatterplot of abdomen circumference and body fat

```{r}
#| label: plot-2

fat |>
  ggplot() +
  aes(x=abdomen, y=fat_b) +
  geom_point() +
  geom_smooth(method="lm", se=FALSE) +
  xlab("Abdomen circumference (cm)") +
  ylab("Percentage body fat") +
  ggtitle("Graph drawn by Steve Simon on 2025-01-25")
```

#### Interpretation of the output

There is a somewhat stronger positive relationship between abdomen circumference and percentage body fat.

## Scatterplot of hip circumference and body fat

```{r}
#| label: plot-3

fat |>
  ggplot() +
  aes(x=abdomen, y=fat_b) +
  geom_point() +
  geom_smooth(method="lm", se=FALSE) +
  xlab("Hip circumference (cm)") +
  ylab("Percentage body fat") +
  ggtitle("Graph drawn by Steve Simon on 2025-01-25")
```

#### Interpretation of the output

There is a weak positive relationship between hip circumference and percentage body fat.

## Linear regression model

```{r}
#| label: regression-1

m0 <- lm(
  fat_b ~ 1, 
  data=fat)

m1 <- lm(
  fat_b ~ abdomen,
  data=fat)

m2 <- lm(
  fat_b ~ chest + abdomen + hip,
  data=fat)
```

#### Comments on the code

Although it is not strictly needed for your data analysis, the first model, m0, is a null model that has no predictor variables other than an intercept.

The m1 model is a simple linear regression model using one predictor variable, abdomen circumference, to predict percentage body fat.

The m2 model uses three predictor variables, chest, abdomen, and hip circumferences. It will help us address the question whether measurements above and below the abdomen produce better predictions than using just the abdomen circumference alone.

## Regression coefficients

```{r}
#| label: coefficients-1

tidy(m0) |>
  mutate(
    p.value =
      case_when(
        p.value <  0.001 ~ "< 0.001",
        p.value >= 0.001 ~ as.character(round(p.value, 3))))

tidy(m1) |>
  mutate(
    p.value =
      case_when(
        p.value <  0.001 ~ "< 0.001",
        p.value >= 0.001 ~ as.character(round(p.value, 3))))

tidy(m2) |>
  mutate(
    p.value =
      case_when(
        p.value <  0.001 ~ "< 0.001",
        p.value >= 0.001 ~ as.character(round(p.value, 3))))
```

## Analysis of variance table

```{r}
#| label: anova
anova(m0, m1)
anova(m0, m1) |> 
  tidy() 
anova(m1, m2) |> tidy()
```

#### Interpretation of the output

## Coefficient estimates

```{r}
#| label: coefficients

tidy(m1)
```

#### Interpretation of the output

## R-squared

```{r}
#| label: r-squared

glance(m1) |>
  select(
    r.squared,
    adj.r.squared)
```

#### Interpretation of the output

## Residuals

```{r}
r2 <- augment(m2)
names(r2)
```

## Residual plots

```{r}
r2 |>
  ggplot() +
    aes(x=.fitted, y=.resid) +
    geom_point() 

r2 |> 
  select(.resid) |>
  bind_cols(fat)
  ggplot() +
    aes(x=wrist, y=.resid) +
    geom_point() 
```

## Variance inflation factor

```{r}
#| label: vif

vif(m2)
```

## Save everything

```{r}
#| label: save
save(
  fat,
  m0,
  m1,
  m2,
  r2,
  file="../data/module02.RData")
```