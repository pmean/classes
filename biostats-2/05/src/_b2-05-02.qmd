---
title: "Interactions in multi-factor analysis of variance"
format: 
  revealjs:
    slide-number: true
    embed-resources: true
editor: source
---

## Hypothetical applications

```{r}
#| label: 05-02-setup
#| message: false
#| warning: false

library(broom)
library(glue)
library(tidyverse)
load("../data/module05.RData")
```

-   Study with two drugs and two placebos
-   Four treatment options
    -   Placebo plus placebo
    -   Drug A plus placebo
    -   Placebo plus Drug B
    -   Drug A plus Drug B
    
::: notes
Consider a hypothetical case. This is a fairly common research scenario where you are looking at the combination effect of two drugs, A and B. The comparison is to a placebo for each drug. This leads to four choices, placebo for A plus a placebo for B, active drug A plus a placebo for drug B, placebo for A plus active drug for B, and finally active drug A plus active drug B.
:::
    
## Listing of hypothetical data

```{r}
#| label: 05-02-listing

hyp <- tibble(
  a=c("P", "P", "A", "A", "P", "P", "A", "A"),
  b=c("P", "P", "P", "P", "B", "B", "B", "B"),
  y=c(1      -0.1,
      1      +0.1, 
      1+2    -0.1,
      1+2    +0.1, 
      1  +3  -0.1,
      1  +3  +0.1,
      1+2+3+4-0.1,
      1+2+3+4+0.1))
hyp$a <- factor(hyp$a, levels=c("P", "A"))
hyp$b <- factor(hyp$b, levels=c("P", "B"))
hyp
```

::: notes
This is what the data might look like if each combination had two observations.
:::

## Line plot of hypothetical data, 1

```{r}
#| label: 05-02-line-plot-1

hyp |>
  group_by(a, b) |>
  summarize(mean_y=mean(y), .groups="drop") |>
  mutate(lab=glue("{a} {b}")) |>
  ggplot() +
  aes(x=a, y=mean_y) +
  expand_limits(y=c(0, 12)) +
  geom_line(aes(group=b)) +
  scale_y_continuous(breaks=(0:6)*2) +
  labs(
    x="Drug A",
    y="Hypothetical mean",
    caption="Steve Simon, 2025-02-18, CC0") -> p1
p1
```

::: notes
This is what the interaction plot looks like for this hypothetical data. Notice the lack of parallelism.
:::

## Create indicator variables

```{r}
#| label: 05-02-indicators

hyp |>
  mutate(i_a=as.numeric(a=="A")) |>
  mutate(i_b=as.numeric(b=="B")) |>
  mutate(i_ab=i_a*i_b) |>
  select(a, b, i_a, i_b, i_ab, y) -> hyp_1
hyp_1
```

::: notes
Here is what the indicator variables look like. Notice that the indicator for the interaction is just the product of the indicator for drug A and the indicator for drug B.
:::

## Interaction model, 1

-   `lm(y=a+b+a:b, data=hyp)`
-   `lm(y=a*b, data=hyp)`
-   `lm(y=i_a+i_b+i_ab, data=hyp_1)`

::: notes
You can fit the interaction term by putting a colon between a and b. An asterisk between a and b means to fit the main effect of a, the main effect of b and the interaction between a and b.

Alternately, you can create indicator variables and use them directly.
:::

## Estimates from the hypothetical data

```{r}
#| label: 05-02-model

m1 <- lm(y~i_a+i_b+i_ab, data=hyp_1)
m1 |>
  tidy() |>
  select(term, estimate)
```

::: notes
Here are the estimates from the hypothetical data. The following slides will show you the proper interpretations of the estimates.
:::

## Interaction model, 2

-   (Intercept): estimated average outcome with two placebos
-   i_a: estimated average change due to drug A alone
-   i_b: estimated average change due to drug B alone
-   i_ab: estimated synergistic (or antagonistic) effect of both drugs

::: notes
The intercept is the estimated average value of Y when all of the indicator variables are equal to zero. This is the average in the P P group. The slope associated with i_a is the estimated average change when moving from placebo to drug A, holding drug B constant. The slope associated with i_b is the estimated average change when moving from placebo to drug B, holding drug A constant. The slope associated with i_ab is the interaction, a measure of how much more the effect of the two drugs combined compared to the effect of drug A along plus drug B alone.
:::

## Interaction model, 3

-   `P P mean = 1`
-   `A P mean = 1 + 2`
-   `P B mean = 1     + 3`
-   `A B mean = 1 + 2 + 3 + 4`

::: notes
The P P mean, the mean for both placebos, is the estimated intercept. The A P mean, the mean for drug A plus placebo, is the estimated intercept plus the estimate for the indicator for drug A. The P A mean, the mean for placebo plus drug B, is the estimated intercept plus the estimate for the indicator for drug B. The A B mean, the mean for drug A plus drug B, would be, if there was no interaction, the estimated intercept plus the estimate for the indicator for drug A plus the indicator for drug B. No interaction means that the combined effect of the two drugs is additive. With an interaction, you have to add in an extra term, the indicator for the interaction. This is a measure of the degree of super-additivity or sub-additivity. It is a measure of the degree of synergy or antagonism. In this case there is super-additivity or a lot of synergy.
:::

## Line plot of hypothetical data, 2

```{r}
#| label: 05-02-line-plot-2

p1 +
  geom_segment(x="P", y=1, xend="A", yend=1, linetype=2) +
  geom_segment(x="P", y=4, xend="A", yend=6, linetype=2) +
  geom_segment(x="P", y=0, xend="P", yend=1) +
  geom_segment(x="A", y=1, xend="A", yend=3) +
  geom_segment(x="P", y=1, xend="P", yend=4) +
  geom_segment(x="A", y=3, xend="A", yend=10) +
  geom_label(x="P", y=0.5, label="b0=1") +
  geom_label(x="A", y=2,   label="b1=2") +
  geom_label(x="P", y=2.5, label="b2=3") +
  geom_label(x="A", y=4.5, label="b2=3") +
  geom_label(x="A", y=8,   label="b3=4")
```

::: notes
Here is the interaction plot, showing the impact of the individual estimates. 

The intercept is 1 showing that the double placebo has an estimated average outcome of 1. 

The estimate for the indicator for A is the change when you move from the double placebo to an active version of A while keeping B as the placebo. The individual effect of drug A by itself is an increase of 2 units on average in the outcome.

The estimate for the indicator for B is the change when you move from the double placebo to an active version of B while keeping A as the placebo. The individual effect of drug B bt itself is an increase of 3 units on average in the outcome.

The estimate for the indicator for the AB interaction is the degree to which the lines depart from parallelism.
:::

## Line plot of hypothetical data, 3

```{r}
#| label: 05-02-line-plot-3

p1 +
  geom_segment(x="P", y=1, xend="A", yend=1, linetype=2) +
  geom_segment(x="P", y=4, xend="A", yend=6, linetype=2) +
  geom_segment(x="P", y=0, xend="P", yend=1) +
  geom_segment(x="A", y=1, xend="A", yend=3) +
  geom_segment(x="P", y=1, xend="P", yend=4) +
  geom_segment(x="A", y=3, xend="A", yend=10) +
  geom_label(x="P", y=1, label="b0=1") +
  geom_label(x="A", y=3, label="b0+b1=1+2") +
  geom_label(x="P", y=4, label="b0+b2=1+3") +
  geom_label(x="A", y=6, label="b0+b1+b2=1+2+3") +
  geom_label(x="A", y=10,label="b0+b1+b2+b3=1+2+3+4")
```

::: notes
This alternate version of the plot shows how to compute the estimated average for each of the combinations: double placebo, A alone, B alone, and A and B commined.

The estimated average for the double placebo is the estimated intercept = 1.

The estimated average for drug A alone is the estimated intercept plus the estimate for the indicator for drug A = 1 + 2.

The estimated average for drug B alone is the estimated intercept plus the estimate for the indicator for drug B = 1 + 3.

The estimated average for both active drugs is the estimated intercept plus the estimate for both indicators plus the estimate for the indicator of interaction = 1 + 2 + 3 + 4. If there were no interaction, the combined effect would only = 1 + 2 + 3.
:::

## Tracking a moving target

-   gender (M or F)
-   child (Yes or No)
-   trial4 (tracking time in seconds)

::: notes
Let's see what an interaction looks like with some more realistic data. Volunteers were given a test of motor skills where they tried to track a moving target. The outcome is the amount of time in seconds that the subjects were successful in tracking. There were both children and adults of both genders in the dataset.
:::

## Means for each combination of gender and child

```{r}
#| label: 05-02-trial4-interaction-table

trial4_interaction_table
```

::: notes
Here are the means and standard deviations for the four combinations: female child, male child, female adult, male adult. Notice that there is almost no diference between male and female children. There is a difference in adults and adults of both genders did better than the children.
:::

## Interaction plot, 1

```{r}
#| label: 05-02-trial4-plot1

trial4_plot1
```

::: notes
Here is the interaction plot, showing a line for females and a line for males.
:::

## Interaction plot, 2

```{r}
#| label: 05-02-trial4-plot2

trial4_plot2
```

::: notes
Here is the alternate interaction plt, showing a line for children and a line for adults. I like this interaction plot a bit better, but both are good.

The child line is flat, showing no gender effect in children. The adult line has a positive slope showing that adult males did a better job on averag in tracking the target than adult females. The separation between the two lines shows that adults of either gender were better than the children of either gender.
:::

## Regression estimates for the interaction model

```{r}
#| label: 05-02-estimates-trial4-table

estimates_trial4_table
```

::: notes
Here are the regression estimates. I will show where these estimates appear within the interaction plot.
:::


## intercept

```{r}
#| label: 05-02-trial4-intercept

trial4_plot2 +
  geom_label(x="F", y=2.57, label="2.57")
```

::: notes
The intercept is the estimated average tracking time for the two reference categories (female and child).
:::

## intercept + genderMale

```{r}
#| label: 05-02-trial4-male

trial4_plot2 +
  geom_label(x="M", y=2.54, label="2.57-0.03=2.54")
```

::: notes
Add the genderMale term to the intercept to get the estimated average tracking time for male children.
:::

## intercept + childNo

```{r}
#| label: 05-02-trial4-child

trial4_plot2 +
  geom_label(x="F", y=4.46, label="2.57+1.89=4.46")
```

::: notes
Add the childNo term to the intercept to get the estimated average tracking time for female adults.
:::


## intercept + genderMale + childNo

```{r}
#| label: 05-02-trial4-no-interaction

trial4_plot2 +
  geom_segment(
    x="M", 
    y=4.46, 
    xend="F", 
    yend=4.43, 
    linetype=2) +
  geom_label(x="M", y=4.43, label="2.57-0.03+1.89=4.46")
```

::: notes
If there were no interaction, then you would add the estimates of effect of genderMale and childNo to the estimated intercept get the estimated average time for adult males.
:::

## intercept + genderMale + childNo + genderMale:childNo

```{r}
#| label: 05-02-trial4-interaction

trial4_plot2 +
  geom_segment(
    x="M", 
    y=4.46, 
    xend="F", 
    yend=4.43, 
    linetype=2) +
  geom_label(x="M", y=6.78, label="2.57-0.03+1.89+2.35=6.78")
```

::: notes
Because there is an interaction, you have to add the estimates of the effect of the interaction to everything else. Male and adulthood are super-additive, meaning that the impact of both combined is more than you would expect from just looking at the individual effects. 
:::