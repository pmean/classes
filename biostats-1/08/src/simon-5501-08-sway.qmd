---
title: "Analysis of postural sway data"
author: "Steve Simon"
format: 
  html:
    embed-resources: true
date: 2024-10-07
---

This program reads data and runs a two-sample t-test. Consult the [data dictionary][dic] for information about the data itself.

[dic]: https://github.com/pmean/data/blob/main/files/postural-sway.yaml

This program was written by Steve Simon on 2024-10-07. It is placed in the public domain.

# --- Part 1: Analysis of front-to-back sway

## Models

-   m1: Comparison of fb_sway by age groups using t.test function
-   m2: Equivalent analysis using lm function

## Libraries

```{r}
#| label: setup
#| message: false
#| warning: false

library(broom)
library(tidyverse)
```

## Read data

```{r}
#| label: read

sway <- read_tsv(
  file="../data/postural-sway.txt",
  col_types="cnn")
names(sway) <- tolower(names(sway))
glimpse(sway)
```

## Boxplot of front-to-back sway by age

```{r}
#| label: boxplot
#| fig.height: 1.5
#| fig.width: 6

sway |>
  ggplot() +
  aes(fbsway, age) +
  geom_boxplot() +
  labs(
    caption="Steve Simon, 2024-10-05, CC0",
    x="Front to back sway",
    y="Treatment group")
```

#### Interpretation of the output

The elderly patients have generally higher sway values. Both groups have similar variation except for an extreme outlier in the elderly patients.

## Descriptive statistics for front-to-back sway by age

```{r}
#| label: group-means

sway |>
  group_by(age) |>
  summarize(
    fb_mn=mean(fbsway),
    fb_sd=sd(fbsway),
    n=n())
```

#### Interpretation of the output

The average front-to-back sway is about 8 millimeters higher on average in the elderly patients. There is more variation in the elderly group, possibly caused by the extreme outlier.

## Two-sample t-test

```{r}
#| label: t-test

m1 <- t.test(
  fbsway ~ age, 
  data=sway,
  alternative="two.sided",
  var.equal=TRUE)
m1
```

#### Comments on the code

The [t.test function][ref-r-nodate] is part of the base R package. You use a formula identical to the formula used in the lm function. The dependent or outcome variable goes to the left of the tilde and the binary category goes on the right. The alternative argument is "two.sided" for a two-sided test. Use "less" to test the one sided hypothesis H1: mu1 < mu2 and "greater" to test the hypothesis H1: mu1 > mu2.

[ref-r-nodate]: https://stat.ethz.ch/R-manual/R-devel/library/stats/html/t.test.html

#### Interpretation of the output

The t-statistic is quite different from zero, the p-value is small and the confidence interval excludes the value of zero. Conclude that there is a larger average front-to-back sway in the elderly group. The confidence interval, however, is quite wide, indicating that you do not have a very precise estimate of how much worse the elderly group is. It could be as small as 0.3 millimeters and as large as 16 millimeters.

## Equivalent analysis using linear regression

```{r}
#| label: lm

m2 <- lm(fbsway ~ age, data=sway)
tidy(m2)
confint(m2)
```

#### Interpretation of the output

The interpretation is identical. Note, however, that the estimated difference and the confidence limits are negative. This is caused by R using an indicator equal to 1 for the last category in alphabetical order (Young).

# --- Part 2: Power calculations for various scenarios

#### Scenario 1

-   Replicate postural sway study
    -   Different populations
    -   Same outcome measure
-   Research hypothesis, $H_0\ \mu_1 - \mu_2 = 0$
-   Standard deviations: 9.77, 4.09
-   MCID = 4

```{r}
#| label: power-1

power.t.test(
  n=NULL,
  delta=4,
  sd=9.8,
  sig.level=0.05,
  power=0.9,
  type="two.sample",
  alternative="two.sided")
```

#### Comments on the code

The [power.t.test][ref-r-nodate1] function is part of the base R package. The arguments are

-   n (sample size)
-   delta (minimum clinically important difference)
-   sd (standard deviation)
-   sig.level (alpha)
-   power (power)
-   type (two independent samples or paired samples)
-   alternative (two-sided or one-sided)

To get a sample size that achieves a pre-specified power level (usually 0.8 or 0.9), set n=NULL. To get the power for a pre-specified sample size, set power=NULL.

The [pwr][ref-r-nodate2] library provides a similar function, pwr.t.test, and has interesting extensions to other statistical tests.

[ref-r-nodate1]: https://stat.ethz.ch/R-manual/R-patched/library/stats/html/power.t.test.html
[ref-r-nodate2]: https://CRAN.R-project.org/package=pwr

#### Interpretation of the output

With a sample of 128 patients, you would have 90% power for detecting a 4 unit difference in postural sway. This assumes that the standard deviation is 9.8 and that you are using a two-sided test at an alpha level of 0.05.

#### Scenario 2, Reduce the MCID from 4 to 2

```{r}
#| label: power-2

power.t.test(
  n=NULL,
  delta=2,
  sd=9.8,
  sig.level=0.05,
  power=0.9,
  type="two.sample",
  alternative="two.sided")
```

#### Interpretation of the output

If we wanted to be able to detect a 2 millimeter difference instead of a 4 millimeter difference, you would need a sample size that is about four times as large.
    
