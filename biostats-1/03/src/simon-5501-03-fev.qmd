---
title: "Analysis of fev data"
format: 
  html:
    embed-resources: true
editor: source
execute: 
  error: true
---

This program assesses the normality of variables in a study of pulmonary function in children. There is a [data dictionary][dd] that provides more details about the data. The program was written by Steve Simon on 2024-09-02 and is placed in the public domain.

[dd]: https://github.com/pmean/datasets/blob/master/fev.yaml

## Libraries

```{r}
#| label: setup
#| message: false
#| warning: false

library(tidyverse)
```

#### Comments on the code

The tidyverse library is the only one you need for this program. The message and warning options limit the diagnostic messages associated with the tidyverse library, which would have just gotten in the way here. If you have some unusual problems later on, removing these options might help you investigate the cause.

## List variable names

```{r}
#| label: names

fev_names <- c(
  "age",
  "fev",
  "ht",
  "sex",
  "smoke")
```

#### Comments on the code

Since the variable names are not listed in the data file itself, you need to specify them here.

## Reading the data

```{r}
#| label: read

fev <- read_csv(
  file="../data/fev.csv",
  col_names=fev_names,
  col_types="nnncc")
glimpse(fev)
```

#### Comments on the code

Here is the code to read the data and show a glimpse. The col_names argument allows you to specify the names. The col_types argument here tells R that the first three columns are numeric and the last two columns are character (string).

## Calculate mean and standard deviation for fev

To orient yourself to the data, calculate a few descriptive statistics.

```{r}
#| label: descriptive-fev

fev |>
  summarize(
    fev_mean=mean(fev),
    fev_stdv=sd(fev))
```

#### Interpretation of the output

The mean fev is 2.6 liters and the standard deviation is 0.84 liters. I am not an expert on pulmonary function, but these values do not appear to be unusually large or small.

## Histogram for fev, wide bars

```{r}
#| label: histogram-fev-wide

fev |>
  ggplot() +
  aes(x=fev) +
  geom_histogram(
    binwidth=0.5,
    color="black",
    fill="white") + 
  scale_x_continuous(breaks=1:6) +
  xlab("Forced Expiratory Volume (Liters)") +
  labs(caption=
    "Steve Simon, 2024-09-02")
```

#### Comments on the code

The geom_histogram function draws a histogram. You should specify values for color (which is the outline of individual bars) and fill (which is what is inside the bars). Also be careful with your choice of binwidth. Don't rely on the default choice.

#### Interpretation of the output

This histogram shows the fev has a slight amount of skewness. I would not quibble with someone who interpreted them as being approximately normal.

## Histogram for fev, narrow bars

```{r}
#| label: histogram-fev-narrow

fev |>
  ggplot() +
	aes(x=fev) +
  geom_histogram(
    binwidth=0.1,
    color="black",
    fill="white") +
  scale_x_continuous(breaks=1:6) +
  xlab("Forced Expiratory Volume (Liters)") +
  labs(caption="Steve Simon, 2024-09-02")
```

#### Interpretation of the output

See above for the interpretation.

This histogram shows a slight amount of skewness. I would quibble with someone who interpreted them as being approximately normal.

## Normal probability plot for fev

```{r}
#| label: qqplot-fev
#| fig-width: 5
#| fig.height: 5

fev |>
	ggplot() +
	aes(sample=fev) +
	stat_qq() +
	ylab("Forced Expiratory Volume (Liters)") +
	ggtitle("Graph produced by Steve Simon on 2024-09-02")
```

#### Comments on the code

The stat_qq function produces a normal probability plot. Notice that the variable fev is identified using the sample argument of aes. I always forget and say aes(x=fev). The default option for most plots is landscape orientation (the width is larger than the height). The normal probability plot, however, looks best if figure is square (the x-axis is the same number of pixels as the y-axis). Setting the overall width and height to the same value doesn't quite make the plot square because of unequal margins around the axes, but it comes close.

#### Interpretation of the output

The normal probability plot has a slight bend,  indicating that the data may have a slight departure from a normal distribution.
