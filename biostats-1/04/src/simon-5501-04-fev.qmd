---
title: "Analysis of relationships in pulmonary data"
format: 
  html:
    embed-resources: true
editor: source
---

This program assesses the relationships among variables in a study of pulmonary function in children. There is a [data dictionary][dd] that provides more details about the data. The program was written by Steve Simon on 2024-09-07 and is placed in the public domain.

[dd]: https://github.com/pmean/datasets/blob/master/fev.yaml

## Libraries

```{r}
#| label: setup
#| message: false
#| warning: false

library(tidyverse)
```

#### Comments on the code

The tidyverse set of libraries are the only ones you need for this program.

## List variable names

```{r}
#| label: names

pulmonary_names <- c(
    "age",
    "fev",
    "ht",
    "sex",
    "smoke")
```

#### Comments on the code

Since the variable names are not listed in the data file itself, you need to list them here.

## Reading the data

Here is the code to read the data and show a glimpse. 

```{r}
#| label: read

pulmonary <- read_csv(
  file="../data/fev.csv",
  col_names=pulmonary_names,
  col_types="nnncc")
glimpse(pulmonary)
```

#### Comments on the code

Here is the code to read the data and show a glimpse. The col_names argument allows you to specify the names. The col_types argument here tells R that the first three columns are numeric and the last two columns are character (string).

## Calculate mean, standard deviation for fev

```{r}
#| label: descriptive-fev

pulmonary |>
  summarize(
    fev_mean=mean(fev),
    fev_stdv=sd(fev))
```

#### Interpretation of the output

The mean fev is 2.6 liters and the standard deviation is 0.87 liters. I am not an expert on pulmonary function, but these values do not appear to be unusually large or small.

## Calculate mean, standard deviation for age

```{r}
#| label: descriptive-age

pulmonary |>
  summarize(
    age_mean=mean(age),
    age_stdv=sd(age))
```

#### Interpretation of the output

The mean age is small, 9.9 years, and the standard deviation, 3.0 implies a tightly packed distribution. This is consistent with a pediatric population.

## Calculate counts for smoke

```{r}
#| label: descriptive-smoke

pulmonary |>
  count(smoke) |>
  mutate(total=sum(n)) |>
  mutate(pct=round(100*n/total)) |>
  mutate(pct=paste0(pct, "%"))
```

#### Comments on the code

The count function produces a count for each level of smoke. The first mutate function calculates a total count for the entire dataset. The second mutate function calculates a percentage and rounds it to the nearest whole number. The third mutate function adds the % sign to the end.

#### Interpretation of the output

Almost all of the subjects (90% or 589 out of 654) were non-smokers.

## Plot age versus fev

```{r}
#| label: plot-age-fev

pulmonary |>
  ggplot() +
	  aes(age, fev) +
    geom_point() +
    geom_smooth() +
    xlab("Age (years)") +
    ylab("Forced Expiratory Volume (Liters)") +
    labs(caption="Steve Simon, 2024-09-07")
```

#### Comments on the code

The aes function identifies the two variables that belong on the X and Y axes, respectively. The geom_point function adds points on the X and Y axes to create a scatterplot. The geom_smooth function adds a smoothing curve to graph.

#### Interpretation of the output

The is a positive relationship between age and fev, though things seems to level off around 14 years.

## Correlation between age and fev

```{r}
#| label: correlation

with(pulmonary, cor(age, fev))
```

#### Comments on the code

The cor function calculates the correlation between age and fev. The with function identifies pulmonary as the dataset where you can find age and fev.

#### Interpretation of the output

The correlation, 0.75, and the plot drawn earlier show a strong positive association between age and fev.

## Plot smoke versus fev

```{r}
#| label: plot-smoke-fev
#| fig.height: 1.5

pulmonary |>
  ggplot() +
    aes(smoke, fev) +
    geom_boxplot() +
    xlab("Smoker (Yes/No)") +
    ylab("Forced Expiratory Volume (Liters)") +
    labs(caption="Steve Simon, 2024-09-07") +
    coord_flip()
```

#### Comments on the code

The geom_boxplot function produces a set of boxplots. It assumes that the X axis contains a categorical variable and the Y axis contains a continuous variable. The coord_flip function swaps the X and Y axes, effectively turning the boxplots horizontal. The fig.height option narrows the boxplots and brings them closer together.

#### Interpretation of the output

The fev values are larger for smokers versus non-smokers. This is the opposite direction from what we expected.

## Means and standard deviations for smokers and non-smokers.

```{r}
#| label: mean-fev-by-smoke

pulmonary |>
  group_by(smoke) |>
  summarize(
    mean_fev=mean(fev),
    sd_fev=sd(fev))
```

#### Comments on the code

The group_by function tells R that any further calculations should be done separately for each level of smoke.

#### Interpretation of the output

The average fev values is 3.1 for smokers and much smaller, 2.6, for non-smokers. This is also opposite from what we expected. The standard deviations, 0.82 and 0.86, are roughly equal.