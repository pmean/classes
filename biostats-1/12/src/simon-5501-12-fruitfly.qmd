---
title: "Analysis of fruitfly data"
format: 
  html:
    embed-resources: true
---

This program reads data on fruit fly longevity. Find more information in the [data dictionary][dd].

[dd]: https://github.com/pmean/data/blob/master/files/fruitfly.yaml

This code was written by Steve Simon on 2024-10-29 and is placed in the public domain.

## Load the tidyverse library

```{r setup}
#| message: false
#| warning: false
library(broom)
library(tidyverse)
```

For most of your programs, you should load the tidyverse library. The broom library converts your output to a nicely arranged dataframe. The messages and warnings are suppressed.

## List the variable names

```{r variable-list}
vlist <- c(
  "id",
  "partners",
  "type",
  "longevity",
  "thorax",
  "sleep")
```

When a dataset does not have variables on the first line, you need to specify them in the code.

## Read the data and view a brief summary

```{r read}
fly <- read_fwf(
  "../data/fruitfly.txt",
  col_types="nnnnnn",
  fwf_widths(
    widths=c(2, 2, 2, 3, 5, 3),
    col_names=vlist))
glimpse(fly)
```

The fruitfly dataset has a fixed width format (fwf). You need to specify the columns that each variable uses.

## Create a subset of fruitfly dataset

```{r subset}
fly |>
  filter(type != 9) -> fly_subset
```

If you exclude the pure control group (No females), you can analyze the two
factors, partners and type individually. Partners has two category levels, 1 for
when one female was included in the cage and 8 for when eight females were 
included in the cage. Type also has two category levels, 0 for pregnant female
fly/flies and 1 for virgin fly/flies. A male fly will not mate with a pregnant
females, so you can think of this as a second level of controls. The two factors
are crossed, meaning that every possible combination of partners and type has 
outcomes measured.

## Draw boxplot of longevity by partners and type

```{r boxplots-partners-type}
#| fig.width: 6
#| fig.height: 2.5
fly_subset |>
  ggplot(aes(factor(partners), longevity, fill=factor(type))) +
    geom_boxplot() +
    xlab("Number of partners") +
    ylab("Lifespan in days") +
    ggtitle("Graphs drawn by Steve Simon on 2024-10-28") +
    labs(fill="Female fly type") +
    scale_fill_discrete(labels=c("Pregnant", "Virgin")) +
    coord_flip()
```

## Calculate average longevity by partners and type

```{r by-partners-and-type}
#| message: false
fly_subset |>
  group_by(partners, type) |>
  summarize(
    longevity_mn=mean(longevity),
    longevity_sd=sd(longevity),
    n=n()) -> fly_means
fly_means
```

## Draw line graph

```{r line-graph}
fly_means |>
  ggplot(aes(
    factor(partners), 
    longevity_mn, 
    group=factor(type),
    color=factor(type))) +
    geom_line(size=2) +
  xlab("Number of partners") +
  ylab("Lifespan in days") +
  labs(color="Female fly type") +
  scale_color_discrete(labels=c("Pregnant", "Virgin"))
```

## Interpretation of the interaction

Male fruitflies sharing a cage with pregnant females have longer average lifespans than sharing a cage with virgin females. The difference in lifespans is much more extreme when sharing with eight female fruitflies compared to one female fruitfly.

The line for pregnant (sharing a cage with pregnant females) is close to flat, indicating that there is little of the number of pregnant females on average longevity.

## Analysis of variance including the interaction

```{r anova-with-interaction}
m1 <- aov(longevity ~ factor(type)*factor(partners), data=fly_subset)
anova(m1)
```

There is a statistically significant interaction between the number of female partners and the type of partners (pregnant or virgin).

## Using lm, 1

```{r lm-with-interactions-1}
m2 <- lm(longevity ~ factor(type)*factor(partners), data=fly_subset)
anova(m2)
```

## Using lm, 2

```{r lm-with-interactions-2}
tidy(m2)
```

## Save important files for later use

```{r save}
save(
  fly,
  fly_subset,
  file="../data/fruitfly.RData")
```